import{aI as E,r as S,U,a as y,ad as k,h as C,g as a,e as r,X as P,u as s,w as u,o as j,t as m,_ as B,a0 as x}from"./CKxg9VfS.js";import{_ as $}from"./tYwaLfcc.js";import{u as q}from"./Bpf85daN.js";import{a as I}from"./Bjtksisr.js";import{_ as z}from"./BHMcXTSu.js";import{_ as M}from"./Bt2YpT3E.js";import"./DZHg-zPW.js";import"./CtxRJYhM.js";import"./DZiD_n4a.js";import"./8F3V6at2.js";import"./B1BtpM6Q.js";import"./BPEFIfMV.js";import"./ChOKVcqp.js";import"./CqMkjHLC.js";import"./CHIgUVhi.js";import"./Bk27txv5.js";import"./-VWu3lWq.js";import"./DWe5xPtV.js";import"./DxI7QMRn.js";import"./gy6MXjwN.js";import"./ChAwXecA.js";import"./Be7d-GBD.js";import"./CbhVS3Xc.js";import"./BH030lJW.js";import"./Be3VPoHw.js";import"./DboHdRIr.js";import"./CMIqKt_m.js";import"./DDBjNozI.js";import"./HiGXOwLp.js";const N={class:"w-full flex flex-col items-stretch gap-4"},R={class:"flex flex-wrap items-end justify-between gap-2"},L={class:"flex items-center gap-2 p-2 rounded-lg shadow-sm"},Q={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},T={class:"flex items-center justify-between"},V={class:"text-2xl font-bold text-red-600"},A={class:"flex items-center justify-between"},G={class:"text-2xl font-bold text-orange-600"},O={class:"flex items-center justify-between"},W={class:"text-2xl font-bold text-yellow-600"},X={class:"flex items-center justify-between"},F={class:"text-2xl font-bold text-green-600"},Ue={__name:"expiring",setup(H){const{toast:_}=E(),l=S(30),h=[{label:"7 days",value:7},{label:"15 days",value:15},{label:"30 days",value:30},{label:"60 days",value:60},{label:"90 days",value:90},{label:"All medicines",value:999999}],{data:g,loading:J,pagination:n,fetchData:f,handlePageChange:b}=q(async({page:t,limit:e})=>{try{const o=await I.get("/api/stock/expiring",{params:{page:t,limit:e,days:l.value}});return n.total=o.total??0,o.data}catch{return _({title:"Error",description:"Unable to load expiring medicines data",variant:"destructive"}),[]}});U(l,()=>{f()});const v=y(()=>g.value),d=y(()=>{var e;if(!((e=g.value)!=null&&e.length))return{expired:0,critical:0,warning:0,good:0};const t={expired:0,critical:0,warning:0,good:0};return g.value.forEach(o=>{o.daysLeft<=0?t.expired++:o.daysLeft<=7?t.critical++:o.daysLeft<=30?t.warning++:t.good++}),t});k(f);const w=t=>t<=0?{text:"Expired",color:"text-red-600 font-bold rounded px-2 py-1"}:t<=7?{text:`${t} days left`,color:"text-orange-600 font-bold rounded px-2 py-1"}:t<=30?{text:`${t} days left`,color:"text-yellow-600 rounded px-2 py-1"}:{text:`${t} days left`,color:"text-green-600 rounded px-2 py-1"},D=t=>t<=0?"bg-red-50":t<=7?"bg-orange-50":"",K=[{accessorKey:"medicine.name",header:"Medicine Name",cell:({row:t})=>{var e;return((e=t.original.medicine)==null?void 0:e.name)||""}},{accessorKey:"batch_id",header:"Batch ID"},{accessorKey:"expiry_date",header:"Expiry Date",cell:({row:t})=>t.original.expiry_date?new Date(t.original.expiry_date).toLocaleDateString():""},{accessorKey:"status",header:"Status",cell:({row:t})=>{const e=w(t.original.daysLeft);return x("div",{class:e.color},e.text)}},{accessorKey:"box_quantity",header:"Box Qty",cell:({row:t})=>x("div",{class:"font-medium"},t.original.box_quantity)},{accessorKey:"unit_quantity",header:"Unit Qty",cell:({row:t})=>x("div",{class:"font-medium"},t.original.unit_quantity)},{accessorKey:"purchase.invoice_no",header:"Purchase Invoice",cell:({row:t})=>{var e;return((e=t.original.purchase)==null?void 0:e.invoice_no)||""}},{accessorKey:"purchase.supplier.name",header:"Supplier",cell:({row:t})=>{var e,o;return((o=(e=t.original.purchase)==null?void 0:e.supplier)==null?void 0:o.name)||""}},{accessorKey:"purchase.date",header:"Purchase Date",cell:({row:t})=>{var e;return(e=t.original.purchase)!=null&&e.date?new Date(t.original.purchase.date).toLocaleDateString():""}}];return(t,e)=>{const o=z,c=B,p=M;return j(),C("div",N,[a("div",R,[e[5]||(e[5]=a("div",null,[a("h2",{class:"text-2xl font-bold tracking-tight"},"Expiring Medicines"),a("p",{class:"text-gray-500"}," List of medicines nearing their expiration date ")],-1)),a("div",L,[e[4]||(e[4]=a("span",{class:"text-sm font-medium"},"Show medicines expiring in:",-1)),r(o,{value:s(l),"onUpdate:value":e[0]||(e[0]=i=>P(l)?l.value=i:null),options:h,style:{width:"120px"},class:"text-primary"},null,8,["value"])])]),a("div",Q,[r(p,{class:"rounded-lg shadow-sm bg-card border-l-4 border-red-500"},{default:u(()=>[a("div",T,[a("div",null,[e[6]||(e[6]=a("p",{class:"text-sm font-medium text-gray-500"},"Expired",-1)),a("p",V,m(s(d).expired),1)]),r(c,{name:"i-lucide-alert-circle",class:"h-6 w-6 text-red-500"})])]),_:1}),r(p,{class:"rounded-lg shadow-sm bg-card border-l-4 border-orange-500"},{default:u(()=>[a("div",A,[a("div",null,[e[7]||(e[7]=a("p",{class:"text-sm font-medium text-gray-500"},"Critical (≤ 7 days)",-1)),a("p",G,m(s(d).critical),1)]),r(c,{name:"i-lucide-alert-triangle",class:"h-6 w-6 text-orange-500"})])]),_:1}),r(p,{class:"rounded-lg shadow-sm bg-card border-l-4 border-yellow-500"},{default:u(()=>[a("div",O,[a("div",null,[e[8]||(e[8]=a("p",{class:"text-sm font-medium text-gray-500"},"Warning (≤ 30 days)",-1)),a("p",W,m(s(d).warning),1)]),r(c,{name:"i-lucide-clock",class:"h-6 w-6 text-yellow-500"})])]),_:1}),r(p,{class:"rounded-lg shadow-sm bg-card border-l-4 border-green-500"},{default:u(()=>[a("div",X,[a("div",null,[e[9]||(e[9]=a("p",{class:"text-sm font-medium text-gray-500"},"Good (> 30 days)",-1)),a("p",F,m(s(d).good),1)]),r(c,{name:"i-lucide-check-circle",class:"h-6 w-6 text-green-500"})])]),_:1})]),r($,{data:s(v),columns:K,filterKey:"medicine.name",page:s(n).page,"onUpdate:page":e[1]||(e[1]=i=>s(n).page=i),onChangePage:s(b),size:s(n).limit,"onUpdate:size":e[2]||(e[2]=i=>s(n).limit=i),total:s(n).total,"onUpdate:total":e[3]||(e[3]=i=>s(n).total=i),"row-class":"hover:bg-gray-50 transition-colors","row-class-name":i=>D(i.original.daysLeft)},null,8,["data","page","onChangePage","size","total","row-class-name"])])}}};export{Ue as default};
