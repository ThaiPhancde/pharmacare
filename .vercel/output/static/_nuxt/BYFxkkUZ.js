import{aU as T,r as y,az as F,aW as O,ad as N,aX as Q,h as d,o as l,e as f,b as R,i as $,w,u as c,M as W,k as D,t as n,_ as A,g as t,y as G,aI as X,a as H,F as B,j as I,aR as J}from"./CKxg9VfS.js";import{_ as K}from"./DKFqWrsj.js";import{a as E}from"./Bjtksisr.js";import{s as Y}from"./x_rD_Ya3.js";import{B as Z}from"./CkclNe_0.js";import{u as tt}from"./Bpf85daN.js";import{_ as et}from"./DlZP_T-Q.js";import{C as st}from"./-VWu3lWq.js";import{C as ot}from"./CNZ14BIZ.js";import{_ as at}from"./C_IQnCrB.js";import"./mUUuLyVv.js";import"./CbhVS3Xc.js";import"./Be7d-GBD.js";import"./DpFlcqSt.js";import"./ChAwXecA.js";import"./DDBjNozI.js";import"./BHMcXTSu.js";import"./gy6MXjwN.js";import"./BH030lJW.js";import"./Be3VPoHw.js";import"./DboHdRIr.js";import"./CMIqKt_m.js";import"./BH33Gl0k.js";import"./HiGXOwLp.js";const nt={class:"p-3 border-b border-foreground"},it={class:"flex items-center justify-between"},rt={class:"text-sm font-semibold text-foreground flex items-center gap-2"},lt={class:"text-xs text-foreground"},ct={class:"max-h-120 overflow-y-auto"},dt={class:"p-2"},pt={class:"flex gap-2 justify-between"},_t={class:"flex flex-col items-center p-1"},ut={class:"text-sm font-bold text-red-600"},xt={class:"flex flex-col items-center p-1"},ft={class:"text-sm font-bold text-orange-600"},mt={class:"flex flex-col items-center p-1"},gt={class:"text-sm font-bold text-yellow-600"},yt={class:"flex flex-col items-center p-1"},ht={class:"text-sm font-bold text-green-600"},vt={class:"p-2 flex justify-center border-t border-foreground"},bt={__name:"Expire",setup(P){const z=T(),h=y(null),u=y(!1),o=y(0),g=y(30),i=F({expired:0,critical:0,warning:0,good:0});O(h,()=>{u.value=!1});const v=()=>{z.push("/stock/expiring"),u.value=!1},p=async()=>{try{const x=await E.get("/api/stock/expiring",{params:{page:1,limit:1,days:g.value}});if(o.value=x.total||0,o.value>0){const e=await E.get("/api/stock/expiring",{params:{page:1,limit:100,days:g.value}});i.expired=0,i.critical=0,i.warning=0,i.good=0,e.data.forEach(_=>{_.daysLeft<=0?i.expired++:_.daysLeft<=7?i.critical++:_.daysLeft<=30?i.warning++:i.good++})}}catch(x){console.error("Unable to load expiring medicines data:",x)}};return N(()=>{p();const x=Y(p,5*60*1e3);Q(()=>{clearInterval(x)})}),(x,e)=>{const _=A,k=Z,C=G,s=K;return l(),d("div",{class:"relative inline-block",ref_key:"containerRef",ref:h},[f(k,{class:"rounded-full hover:bg-gray-600",quaternary:"",onClick:e[0]||(e[0]=r=>u.value=!u.value)},{default:w(()=>[o.value>0?(l(),R(c(W),{key:0,class:"absolute -top-1 -right-1",variant:"destructive"},{default:w(()=>[D(n(o.value>99?"99+":o.value),1)]),_:1})):$("",!0),f(_,{name:"i-lucide-pill",class:"h-6 w-6 text-primary"})]),_:1}),u.value?(l(),R(s,{key:0,class:"absolute right-0 mt-2 w-72 rounded-md shadow-lg border-foreground border ring-primary ring-opacity-5 z-50"},{default:w(()=>[t("div",nt,[t("div",it,[t("h3",rt,[f(_,{name:"i-lucide-alert-circle",class:"h-4 w-4 text-red-600"}),e[1]||(e[1]=D(" Expiring Medicines "))]),t("span",lt,n(o.value)+" items",1)])]),t("div",ct,[t("div",dt,[t("div",pt,[t("div",_t,[e[2]||(e[2]=t("span",{class:"text-xs text-foreground"},"Expired",-1)),t("span",ut,n(i.expired),1)]),t("div",xt,[e[3]||(e[3]=t("span",{class:"text-xs text-foreground"},"Critical",-1)),t("span",ft,n(i.critical),1)]),t("div",mt,[e[4]||(e[4]=t("span",{class:"text-xs text-foreground"},"Warning",-1)),t("span",gt,n(i.warning),1)]),t("div",yt,[e[5]||(e[5]=t("span",{class:"text-xs text-foreground"},"Good",-1)),t("span",ht,n(i.good),1)])])])]),t("div",vt,[f(C,{class:"hover:bg-red-600 text-white",onClick:v},{default:w(()=>[f(_,{name:"i-lucide-arrow-right",class:"h-3 w-3"}),e[6]||(e[6]=D(" View All Expiring Medicines "))]),_:1,__:[6]})])]),_:1})):$("",!0)],512)}}},wt={class:"w-full flex flex-col items-stretch gap-4"},$t={class:"flex flex-wrap items-end justify-between gap-2"},kt={key:0,class:"flex justify-center items-center py-8"},Ct={key:1,class:"overflow-x-auto w-full"},Dt={class:"w-full border-collapse"},Bt=["onClick"],Rt={class:"px-2 py-3 text-center"},Et={class:"px-4 py-3"},zt={class:"px-4 py-3"},jt={class:"px-4 py-3"},Mt={key:0,class:"bg-gray-50"},St={colspan:"4",class:"p-0"},Ut={class:"p-4"},Lt={class:"w-full border-collapse"},It={class:"px-3 py-2"},Nt={class:"px-3 py-2"},Pt={class:"px-3 py-2"},Vt={class:"px-3 py-2"},qt={class:"px-3 py-2"},Tt={key:0},Ft={class:"flex justify-end mt-4"},ue={__name:"index",setup(P){const{toast:z}=X(),{data:h,loading:u,pagination:o,fetchData:g,handlePageChange:i}=tt(async({page:s,limit:r})=>{const b=await E.get("/api/stock",{params:{page:s,limit:r}});return o.total=b.total??0,b.data}),v=H(()=>h.value),p=y(new Set),x=s=>{p.value.has(s)?p.value.delete(s):p.value.add(s)},e=s=>p.value.has(s),_=s=>s?new Date(s).toLocaleDateString():"",k=s=>{o.page=s,g(),p.value.clear()},C=s=>{o.limit=s,o.page=1,g(),p.value.clear()};return N(g),(s,r)=>{const b=bt,V=at,q=et;return l(),d("div",wt,[t("div",$t,[r[1]||(r[1]=t("h2",{class:"text-2xl font-bold tracking-tight"},"List Stock",-1)),f(b)]),c(u)?(l(),d("div",kt,[f(V,{size:"large"})])):(l(),d("div",Ct,[t("table",Dt,[r[4]||(r[4]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"w-8 px-2 py-3 text-left"}),t("th",{class:"px-4 py-3 text-left font-medium"},"Medicine"),t("th",{class:"px-4 py-3 text-left font-medium"},"Batch ID"),t("th",{class:"px-4 py-3 text-left font-medium"},"Total Units")])],-1)),t("tbody",null,[(l(!0),d(B,null,I(c(v),a=>{var j,M,S,U;return l(),d(B,{key:`${(j=a.medicine)==null?void 0:j._id}-${a.batch_id}`},[t("tr",{class:"border-b hover:bg-gray-50 cursor-pointer",onClick:m=>{var L;return x(`${(L=a.medicine)==null?void 0:L._id}${a.batch_id}`)}},[t("td",Rt,[(l(),R(J(e(`${(M=a.medicine)==null?void 0:M._id}${a.batch_id}`)?c(st):c(ot)),{class:"w-4 h-4"}))]),t("td",Et,n((S=a.medicine)==null?void 0:S.name),1),t("td",zt,n(a.batch_id),1),t("td",jt,n(a.total_unit_quantity),1)],8,Bt),e(`${(U=a.medicine)==null?void 0:U._id}${a.batch_id}`)?(l(),d("tr",Mt,[t("td",St,[t("div",Ut,[t("table",Lt,[r[2]||(r[2]=t("thead",null,[t("tr",{class:"bg-gray-100 text-xs"},[t("th",{class:"px-3 py-2 text-left font-medium"},"Expiry Date"),t("th",{class:"px-3 py-2 text-left font-medium"},"Box Pattern"),t("th",{class:"px-3 py-2 text-left font-medium"},"Box Qty"),t("th",{class:"px-3 py-2 text-left font-medium"},"Unit Qty"),t("th",{class:"px-3 py-2 text-left font-medium"},"Supplier")])],-1)),t("tbody",null,[(l(!0),d(B,null,I(a.variants,m=>(l(),d("tr",{key:m._id,class:"border-b border-gray-200 text-sm"},[t("td",It,n(_(m.expiry_date)),1),t("td",Nt,n(m.box_pattern),1),t("td",Pt,n(m.box_quantity),1),t("td",Vt,n(m.unit_quantity),1),t("td",qt,n(m.supplier),1)]))),128))])])])])])):$("",!0)],64)}),128)),!c(u)&&c(v).length===0?(l(),d("tr",Tt,r[3]||(r[3]=[t("td",{colspan:"4",class:"px-4 py-8 text-center text-gray-500"}," No stock items found ",-1)]))):$("",!0)])])])),t("div",Ft,[f(q,{page:c(o).page,"onUpdate:page":[r[0]||(r[0]=a=>c(o).page=a),k],"page-count":Math.ceil(c(o).total/c(o).limit),"page-size":c(o).limit,"page-sizes":[10,20,30,40],"onUpdate:pageSize":C},null,8,["page","page-count","page-size"])])])}}};export{ue as default};
