import{d as K,h as b,o as y,n as J,u as n,f as le,p as ae,r as v,a as M,ad as oe,g as t,i as S,e as a,w as o,a$ as $,b0 as A,b1 as re,t as d,F as ne,j as ie,b2 as de,k as m,y as f,b3 as B}from"./CKxg9VfS.js";import{_ as N,a as V,b as F,c as z}from"./y658cYhg.js";import{_ as ue}from"./Bt2YpT3E.js";import"./CbhVS3Xc.js";import"./HiGXOwLp.js";const O=K({__name:"DialogFooter",props:{class:{}},setup(P){const i=P;return(w,h)=>(y(),b("div",{class:J(n(le)("flex flex-col-reverse sm:flex-row sm:justify-end sm:gap-x-2",i.class))},[ae(w.$slots,"default")],2))}}),ve={class:"w-full flex flex-col items-stretch gap-4"},pe={class:"flex flex-wrap items-end justify-between gap-2"},ce={class:"flex items-center gap-2"},ge={key:0,class:"mr-2"},me={key:0,class:"mr-2"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},we={class:"flex items-center justify-between"},xe={class:"text-2xl font-bold text-blue-600"},be={class:"flex items-center justify-between"},ye={class:"text-2xl font-bold text-green-600"},he={class:"flex items-center justify-between"},ke={class:"text-2xl font-bold text-purple-600"},_e={class:"flex items-center justify-between"},Ce={class:"text-2xl font-bold text-orange-600"},$e={class:"flex mb-4"},je={class:"relative w-full"},qe={key:0,class:"mb-4 text-sm text-gray-500"},Ae={class:"border rounded-lg bg-card overflow-hidden"},Se={class:"w-full border-collapse"},Te={key:0},Ee={key:1},Ie={class:"p-3"},De={class:"p-3"},Qe={class:"p-3"},Me={class:"p-3"},Pe={class:"flex space-x-1"},Ue={class:"grid gap-4 py-4"},Le={class:"grid grid-cols-4 items-center gap-4"},Be={class:"grid grid-cols-4 items-center gap-4"},Ne={class:"grid grid-cols-4 items-center gap-4"},Ve={class:"grid grid-cols-4 items-center gap-4"},Fe={class:"grid grid-cols-4 items-center gap-4"},ze={key:0,class:"mr-2"},Oe={class:"mt-4 flex justify-between items-center border-t pt-4"},Ke={class:"text-sm text-gray-500"},Je={class:"flex items-center space-x-2"},Re={class:"flex items-center space-x-1"},Ge={class:"flex items-center space-x-1"},He={class:"mx-2 text-sm"},tt=K({__name:"chatbot",setup(P){const i=v([]),w=v(!1),h=v(""),j=v(!1),x=v(null),k=v(null),q=v(!1),T=v(null),u=v(""),p=v(!0),r=v({page:1,limit:10,total:0,get totalPages(){return Math.ceil(this.total/this.limit)}}),c=v({question:"",answer:"",category:"",keywords:"",medicineTerms:""}),E=v(!1),I=v(null);M(()=>{if(!h.value)return i.value;const l=h.value.toLowerCase();return i.value.filter(e=>e.question.toLowerCase().includes(l)||e.answer.toLowerCase().includes(l)||e.category&&e.category.toLowerCase().includes(l))});const U=M(()=>{const l={};return i.value.forEach(e=>{const g=e.category||"uncategorized";l[g]=(l[g]||0)+1}),l}),R=M(()=>{const l=U.value;let e=0,g="None";return Object.entries(l).forEach(([s,C])=>{C>e&&(e=C,g=s)}),g}),_=async()=>{w.value=!0;try{const e=await(await fetch(`/api/chatbot/qa?page=${r.value.page}&limit=${r.value.limit}`)).json();e.success?(i.value=e.data,r.value.total=e.total,T.value=new Date().toLocaleString()):console.error("Failed to fetch data:",e.message)}catch(l){console.error("Error fetching chatbot data:",l)}finally{w.value=!1}},L=async()=>{if(!h.value.trim()){_();return}w.value=!0;try{const e=await(await fetch(`/api/chatbot/qa/search?q=${encodeURIComponent(h.value)}&page=${r.value.page}&limit=${r.value.limit}`)).json();e.success?(i.value=e.data,r.value.total=e.total,r.value.page=e.page):console.error("Search failed:",e.message)}catch(l){console.error("Error searching:",l)}finally{w.value=!1}},G=()=>{h.value="",_()},H=async()=>{w.value=!0,u.value="",p.value=!0,I.value=null;try{const e=await(await fetch("/api/chatbot/parse-medicine-data",{method:"POST"})).json();e.success?(u.value=`Successfully imported ${e.count} QA pairs from Medicine.txt`,I.value=e.data,_()):(console.error("Failed to import data:",e.message),p.value=!1,u.value=e.message||"Import failed")}catch(l){console.error("Error importing chatbot data:",l),p.value=!1,u.value="Error importing chatbot data"}finally{w.value=!1}},W=l=>{x.value=l,c.value={question:l.question,answer:l.answer,category:l.category||"",keywords:l.keywords||"",medicineTerms:l.medicineTerms||""},j.value=!0},X=l=>{k.value=l},Y=async()=>{if(k.value){q.value=!0;try{const e=await(await fetch(`/api/chatbot/qa/${k.value._id}`,{method:"DELETE"})).json();e.success?(i.value=i.value.filter(g=>g._id!==k.value._id),p.value=!0,u.value="Item deleted successfully"):(console.error("Failed to delete:",e.message),p.value=!1,u.value=e.message||"Delete failed")}catch(l){console.error("Error deleting item:",l),p.value=!1,u.value="Error deleting item"}finally{k.value=null,q.value=!1}}},Z=async()=>{q.value=!0;try{let l="/api/chatbot/qa",e="POST";x.value&&(l=`/api/chatbot/qa/${x.value._id}`,e="PUT");const s=await(await fetch(l,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(c.value)})).json();if(s.success){if(x.value){const C=i.value.findIndex(Q=>Q._id===x.value._id);C!==-1&&(i.value[C]=s.data)}else i.value.unshift(s.data);j.value=!1,p.value=!0,u.value=x.value?"Item updated successfully":"Item added successfully",x.value=null,ee()}else console.error("Failed to save QA pair:",s.message),p.value=!1,u.value=s.message||"Save failed"}catch(l){console.error("Error saving QA pair:",l),p.value=!1,u.value="Error saving QA pair"}finally{q.value=!1}},ee=()=>{c.value={question:"",answer:"",category:"",keywords:"",medicineTerms:""}},te=async()=>{E.value=!0,u.value="Đang import dữ liệu từ database...",p.value=!0,I.value=null;try{const e=await(await fetch("/api/chatbot/import-database-data",{method:"POST"})).json();e.success?(u.value=e.message,p.value=!0,I.value=e.data,_()):(u.value=`Lỗi: ${e.message}`,p.value=!1)}catch(l){u.value=`Lỗi: ${l.message||"Không thể import dữ liệu"}`,p.value=!1}finally{E.value=!1}},D=l=>{l>=1&&l<=r.value.totalPages&&(r.value.page=l,_())},se=l=>{r.value.limit=l,r.value.page=1,_()};return oe(_),(l,e)=>{const g=ue;return y(),b("div",ve,[t("div",pe,[e[22]||(e[22]=t("div",null,[t("h2",{class:"text-2xl font-bold tracking-tight"},"PharmaCare Chatbot Management"),t("p",{class:"text-gray-500"},"Manage chatbot questions and answers")],-1)),t("div",ce,[a(n(f),{onClick:H,disabled:w.value,variant:"outline"},{default:o(()=>[w.value?(y(),b("span",ge,e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M12 3a9 9 0 1 0 9 9"})],-1)]))):S("",!0),e[18]||(e[18]=m(" Import from Medicine.txt "))]),_:1,__:[18]},8,["disabled"]),a(n(f),{onClick:te,disabled:E.value,variant:"outline"},{default:o(()=>[E.value?(y(),b("span",me,e[19]||(e[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M12 3a9 9 0 1 0 9 9"})],-1)]))):S("",!0),e[20]||(e[20]=m(" Import from Database "))]),_:1,__:[20]},8,["disabled"]),a(n(f),{onClick:e[0]||(e[0]=s=>j.value=!0),variant:"default"},{default:o(()=>e[21]||(e[21]=[m(" Add New QA ")])),_:1,__:[21]})])]),t("div",fe,[a(g,{class:"rounded-lg shadow-sm bg-card border-l-4 border-blue-500"},{default:o(()=>[t("div",we,[t("div",null,[e[23]||(e[23]=t("p",{class:"text-sm font-medium text-gray-500"},"Total QA Pairs",-1)),t("p",xe,d(r.value.total),1)]),e[24]||(e[24]=t("div",{class:"i-lucide-file-question h-6 w-6 text-blue-500"},null,-1))])]),_:1}),a(g,{class:"rounded-lg shadow-sm bg-card border-l-4 border-green-500"},{default:o(()=>[t("div",be,[t("div",null,[e[25]||(e[25]=t("p",{class:"text-sm font-medium text-gray-500"},"Categories",-1)),t("p",ye,d(Object.keys(U.value).length),1)]),e[26]||(e[26]=t("div",{class:"i-lucide-tags h-6 w-6 text-green-500"},null,-1))])]),_:1}),a(g,{class:"rounded-lg shadow-sm bg-card border-l-4 border-purple-500"},{default:o(()=>[t("div",he,[t("div",null,[e[27]||(e[27]=t("p",{class:"text-sm font-medium text-gray-500"},"Most Common Category",-1)),t("p",ke,d(R.value),1)]),e[28]||(e[28]=t("div",{class:"i-lucide-bar-chart h-6 w-6 text-purple-500"},null,-1))])]),_:1}),a(g,{class:"rounded-lg shadow-sm bg-card border-l-4 border-orange-500"},{default:o(()=>{var s;return[t("div",_e,[t("div",null,[e[29]||(e[29]=t("p",{class:"text-sm font-medium text-gray-500"},"Last Updated",-1)),t("p",Ce,d(((s=T.value)==null?void 0:s.split(" ")[0])||"N/A"),1)]),e[30]||(e[30]=t("div",{class:"i-lucide-clock h-6 w-6 text-orange-500"},null,-1))])]}),_:1})]),t("div",$e,[t("div",je,[e[31]||(e[31]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{class:"h-5 w-5 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"11",cy:"11",r:"8"}),t("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})])],-1)),$(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>h.value=s),class:"block w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500",placeholder:"Search questions or answers",type:"search",onKeyup:re(L,["enter"])},null,544),[[A,h.value]])]),t("button",{onClick:L,class:"ml-2 px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700"}," Search "),t("button",{onClick:G,class:"ml-2 px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300"}," Clear ")]),T.value?(y(),b("p",qe,"Last updated: "+d(T.value),1)):S("",!0),t("div",Ae,[t("table",Se,[e[36]||(e[36]=t("thead",null,[t("tr",{class:"border-b bg-muted/50"},[t("th",{class:"p-3 text-left font-medium text-muted-foreground"},"Question"),t("th",{class:"p-3 text-left font-medium text-muted-foreground"},"Answer"),t("th",{class:"p-3 text-left font-medium text-muted-foreground w-24"},"Category"),t("th",{class:"p-3 text-left font-medium text-muted-foreground w-36"},"Actions")])],-1)),t("tbody",null,[w.value?(y(),b("tr",Te,e[32]||(e[32]=[t("td",{colspan:"4",class:"p-3 text-center"},"Loading...",-1)]))):i.value.length===0?(y(),b("tr",Ee,e[33]||(e[33]=[t("td",{colspan:"4",class:"p-3 text-center"},"No data available. Import or add data.",-1)]))):S("",!0),(y(!0),b(ne,null,ie(i.value,(s,C)=>(y(),b("tr",{key:C,class:"hover:bg-muted/50 border-b"},[t("td",Ie,d(s.question),1),t("td",De,d(s.answer),1),t("td",Qe,[t("span",{class:J(["px-2 py-1 rounded-full text-xs font-semibold",{"text-green-600 bg-green-100":s.category==="general","text-blue-600 bg-blue-100":s.category==="price","text-purple-600 bg-purple-100":s.category!=="general"&&s.category!=="price"}])},d(s.category||"general"),3)]),t("td",Me,[t("div",Pe,[a(n(f),{variant:"outline",size:"sm",onClick:Q=>W(s)},{default:o(()=>e[34]||(e[34]=[m(" Edit ")])),_:2,__:[34]},1032,["onClick"]),a(n(f),{variant:"destructive",size:"sm",onClick:Q=>X(s)},{default:o(()=>e[35]||(e[35]=[m(" Delete ")])),_:2,__:[35]},1032,["onClick"])])])]))),128))])])]),a(n(z),{open:j.value,"onUpdate:open":e[8]||(e[8]=s=>j.value=s)},{default:o(()=>[a(n(N),{class:"sm:max-w-[600px]"},{default:o(()=>[a(n(V),null,{default:o(()=>[a(n(F),null,{default:o(()=>[m(d(x.value?"Edit QA Pair":"Add New QA Pair"),1)]),_:1}),a(n(B),null,{default:o(()=>[m(d(x.value?"Update the existing question and answer":"Add a new question and answer to your database"),1)]),_:1})]),_:1}),t("div",Ue,[t("div",Le,[e[37]||(e[37]=t("label",{for:"question",class:"text-right"},"Question:",-1)),$(t("textarea",{id:"question","onUpdate:modelValue":e[2]||(e[2]=s=>c.value.question=s),class:"col-span-3 flex h-20 w-full rounded-md border border-input px-3 py-2"},null,512),[[A,c.value.question]])]),t("div",Be,[e[38]||(e[38]=t("label",{for:"answer",class:"text-right"},"Answer:",-1)),$(t("textarea",{id:"answer","onUpdate:modelValue":e[3]||(e[3]=s=>c.value.answer=s),class:"col-span-3 flex h-40 w-full rounded-md border border-input px-3 py-2"},null,512),[[A,c.value.answer]])]),t("div",Ne,[e[39]||(e[39]=t("label",{for:"category",class:"text-right"},"Category:",-1)),$(t("input",{id:"category","onUpdate:modelValue":e[4]||(e[4]=s=>c.value.category=s),class:"col-span-3 flex h-10 w-full rounded-md border border-input px-3 py-2",placeholder:"E.g. general, dosage, side-effects"},null,512),[[A,c.value.category]])]),t("div",Ve,[e[40]||(e[40]=t("label",{for:"keywords",class:"text-right"},"Keywords:",-1)),$(t("input",{id:"keywords","onUpdate:modelValue":e[5]||(e[5]=s=>c.value.keywords=s),class:"col-span-3 flex h-10 w-full rounded-md border border-input px-3 py-2",placeholder:"Space-separated keywords to improve search"},null,512),[[A,c.value.keywords]])]),t("div",Fe,[e[41]||(e[41]=t("label",{for:"medicineTerms",class:"text-right"},"Medicine Terms:",-1)),$(t("input",{id:"medicineTerms","onUpdate:modelValue":e[6]||(e[6]=s=>c.value.medicineTerms=s),class:"col-span-3 flex h-10 w-full rounded-md border border-input px-3 py-2",placeholder:"Names of medicines relevant to this Q&A"},null,512),[[A,c.value.medicineTerms]])])]),a(n(O),null,{default:o(()=>[a(n(f),{variant:"outline",onClick:e[7]||(e[7]=s=>j.value=!1)},{default:o(()=>e[42]||(e[42]=[m("Cancel")])),_:1,__:[42]}),a(n(f),{disabled:q.value,onClick:Z},{default:o(()=>[q.value?(y(),b("span",ze,e[43]||(e[43]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 3a9 9 0 1 0 9 9"})],-1)]))):S("",!0),m(" "+d(x.value?"Update":"Add"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),a(n(z),{open:k.value!==null,"onUpdate:open":e[10]||(e[10]=s=>k.value=null)},{default:o(()=>[a(n(N),{class:"sm:max-w-[425px]"},{default:o(()=>[a(n(V),null,{default:o(()=>[a(n(F),null,{default:o(()=>e[44]||(e[44]=[m("Confirm Deletion")])),_:1,__:[44]}),a(n(B),null,{default:o(()=>e[45]||(e[45]=[m(" Are you sure you want to delete this Q&A pair? This action cannot be undone. ")])),_:1,__:[45]})]),_:1}),a(n(O),null,{default:o(()=>[a(n(f),{variant:"outline",onClick:e[9]||(e[9]=s=>k.value=null)},{default:o(()=>e[46]||(e[46]=[m("Cancel")])),_:1,__:[46]}),a(n(f),{variant:"destructive",onClick:Y},{default:o(()=>e[47]||(e[47]=[m("Delete")])),_:1,__:[47]})]),_:1})]),_:1})]),_:1},8,["open"]),t("div",Oe,[t("div",Ke," Showing "+d(i.value.length)+" of "+d(r.value.total)+" QA pairs ",1),t("div",Je,[t("div",Re,[e[49]||(e[49]=t("span",{class:"text-sm"},"Items per page:",-1)),$(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>r.value.limit=s),class:"px-2 py-1 border rounded-md text-sm",onChange:e[12]||(e[12]=s=>se(parseInt(s.target.value)))},e[48]||(e[48]=[t("option",{value:10},"10",-1),t("option",{value:20},"20",-1),t("option",{value:30},"30",-1),t("option",{value:50},"50",-1)]),544),[[de,r.value.limit]])]),t("div",Ge,[a(n(f),{variant:"outline",size:"sm",onClick:e[13]||(e[13]=s=>D(1)),disabled:r.value.page===1},{default:o(()=>e[50]||(e[50]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-chevrons-left"},[t("path",{d:"m11 17-5-5 5-5"}),t("path",{d:"m18 17-5-5 5-5"})],-1)])),_:1,__:[50]},8,["disabled"]),a(n(f),{variant:"outline",size:"sm",onClick:e[14]||(e[14]=s=>D(r.value.page-1)),disabled:r.value.page===1},{default:o(()=>e[51]||(e[51]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-chevron-left"},[t("path",{d:"m15 18-6-6 6-6"})],-1)])),_:1,__:[51]},8,["disabled"]),t("span",He," Page "+d(r.value.page)+" of "+d(r.value.totalPages),1),a(n(f),{variant:"outline",size:"sm",onClick:e[15]||(e[15]=s=>D(r.value.page+1)),disabled:r.value.page===r.value.totalPages},{default:o(()=>e[52]||(e[52]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-chevron-right"},[t("path",{d:"m9 18 6-6-6-6"})],-1)])),_:1,__:[52]},8,["disabled"]),a(n(f),{variant:"outline",size:"sm",onClick:e[16]||(e[16]=s=>D(r.value.totalPages)),disabled:r.value.page===r.value.totalPages},{default:o(()=>e[53]||(e[53]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-chevrons-right"},[t("path",{d:"m13 17 5-5-5-5"}),t("path",{d:"m6 17 5-5-5-5"})],-1)])),_:1,__:[53]},8,["disabled"])])])])])}}});export{tt as default};
