import{a as I,r as b,aX as ke,bd as ce,d as Z,a0 as w,b8 as $e,a9 as Re,ba as Ne,aE as Ee,aw as Ge,v as ae,ab as pe,bp as Y,ad as ne,aD as ze,$ as oe,cG as le,a2 as L,a4 as J,a6 as U,bc as Be,ac as ve,ae as De,ag as Pe,P as Ie,h as M,o as P,e as c,w as h,g as n,i as W,k as V,t as $,u as ee,a_ as He,aU as Te,b as re,F as de,j as Me}from"./CKxg9VfS.js";import{u as fe}from"./BUAQ2s_u.js";import{i as Ae,B as me}from"./CkclNe_0.js";import{_ as Ve}from"./BjVYSpcv.js";import{_ as je}from"./DpFlcqSt.js";import{_ as Oe}from"./BHMcXTSu.js";import{_ as Fe}from"./BpvOLQCW.js";import{g as Le,_ as Ue,a as qe}from"./fmyKo3Du.js";import{_ as We}from"./B8BHpYNb.js";import{_ as Qe}from"./BjNiWSUp.js";import{_ as _e}from"./Bt2YpT3E.js";import{V as Xe}from"./ChAwXecA.js";import{i as Ye,v as Je}from"./gy6MXjwN.js";import{p as F}from"./CbhVS3Xc.js";import{b as Ze}from"./BH030lJW.js";import{_ as Ke}from"./CWYSDPom.js";import{_ as et}from"./C_IQnCrB.js";import{N as tt}from"./BloDjXvy.js";import"./Bjtksisr.js";import"./mUUuLyVv.js";import"./Be7d-GBD.js";import"./DDBjNozI.js";import"./DboHdRIr.js";import"./CMIqKt_m.js";import"./Be3VPoHw.js";import"./BUV3okvS.js";import"./HiGXOwLp.js";function nt(i){if(typeof i=="number")return{"":i.toString()};const o={};return i.split(/ +/).forEach(d=>{if(d==="")return;const[l,a]=d.split(":");a===void 0?o[""]=l:o[l]=a}),o}function O(i,o){var d;if(i==null)return;const l=nt(i);if(o===void 0)return l[""];if(typeof o=="string")return(d=l[o])!==null&&d!==void 0?d:l[""];if(Array.isArray(o)){for(let a=o.length-1;a>=0;--a){const e=o[a];if(e in l)return l[e]}return l[""]}else{let a,e=-1;return Object.keys(l).forEach(p=>{const r=Number(p);!Number.isNaN(r)&&o>=r&&r>=e&&(e=r,a=l[p])}),a}}const st={xs:0,s:640,m:1024,l:1280,xl:1536,"2xl":1920};function it(i){return`(min-width: ${i}px)`}const q={};function at(i=st){if(!Ye)return I(()=>[]);if(typeof window.matchMedia!="function")return I(()=>[]);const o=b({}),d=Object.keys(i),l=(a,e)=>{a.matches?o.value[e]=!0:o.value[e]=!1};return d.forEach(a=>{const e=i[a];let p,r;q[e]===void 0?(p=window.matchMedia(it(e)),p.addEventListener?p.addEventListener("change",g=>{r.forEach(v=>{v(g,a)})}):p.addListener&&p.addListener(g=>{r.forEach(v=>{v(g,a)})}),r=new Set,q[e]={mql:p,cbs:r}):(p=q[e].mql,r=q[e].cbs),r.add(l),p.matches&&r.forEach(g=>{g(p,a)})}),ke(()=>{d.forEach(a=>{const{cbs:e}=q[i[a]];e.has(l)&&e.delete(l)})}),I(()=>{const{value:a}=o;return d.filter(e=>a[e])})}function ot(i){var o;const d=(o=i.dirs)===null||o===void 0?void 0:o.find(({dir:l})=>l===ce);return!!(d&&d.value===!1)}const lt=Z({name:"ArrowBack",render(){return w("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},w("path",{d:"M0 0h24v24H0V0z",fill:"none"}),w("path",{d:"M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z"}))}}),rt={titleFontSize:"18px",backSize:"22px"};function dt(i){const{textColor1:o,textColor2:d,textColor3:l,fontSize:a,fontWeightStrong:e,primaryColorHover:p,primaryColorPressed:r}=i;return Object.assign(Object.assign({},rt),{titleFontWeight:e,fontSize:a,titleTextColor:o,backColor:d,backColorHover:p,backColorPressed:r,subtitleTextColor:l})}const ut=$e({name:"PageHeader",common:Re,self:dt}),ue=1,he=Ne("n-grid"),ge=1,ct={span:{type:[Number,String],default:ge},offset:{type:[Number,String],default:0},suffix:Boolean,privateOffset:Number,privateSpan:Number,privateColStart:Number,privateShow:{type:Boolean,default:!0}},pt=Z({__GRID_ITEM__:!0,name:"GridItem",alias:["Gi"],props:ct,setup(){const{isSsrRef:i,xGapRef:o,itemStyleRef:d,overflowRef:l,layoutShiftDisabledRef:a}=Ee(he),e=Ge();return{overflow:l,itemStyle:d,layoutShiftDisabled:a,mergedXGap:I(()=>F(o.value||0)),deriveStyle:()=>{i.value;const{privateSpan:p=ge,privateShow:r=!0,privateColStart:g=void 0,privateOffset:v=0}=e.vnode.props,{value:x}=o,C=F(x||0);return{display:r?"":"none",gridColumn:`${g??`span ${p}`} / span ${p}`,marginLeft:v?`calc((100% - (${p} - 1) * ${C}) / ${p} * ${v} + ${C} * ${v})`:""}}}},render(){var i,o;if(this.layoutShiftDisabled){const{span:d,offset:l,mergedXGap:a}=this;return w("div",{style:{gridColumn:`span ${d} / span ${d}`,marginLeft:l?`calc((100% - (${d} - 1) * ${a}) / ${d} * ${l} + ${a} * ${l})`:""}},this.$slots)}return w("div",{style:[this.itemStyle,this.deriveStyle()]},(o=(i=this.$slots).default)===null||o===void 0?void 0:o.call(i,{overflow:this.overflow}))}}),vt={xs:0,s:640,m:1024,l:1280,xl:1536,xxl:1920},ye=24,te="__ssr__",ft={layoutShiftDisabled:Boolean,responsive:{type:[String,Boolean],default:"self"},cols:{type:[Number,String],default:ye},itemResponsive:Boolean,collapsed:Boolean,collapsedRows:{type:Number,default:1},itemStyle:[Object,String],xGap:{type:[Number,String],default:0},yGap:{type:[Number,String],default:0}},mt=Z({name:"Grid",inheritAttrs:!1,props:ft,setup(i){const{mergedClsPrefixRef:o,mergedBreakpointsRef:d}=pe(i),l=/^\d+$/,a=b(void 0),e=at((d==null?void 0:d.value)||vt),p=Y(()=>!!(i.itemResponsive||!l.test(i.cols.toString())||!l.test(i.xGap.toString())||!l.test(i.yGap.toString()))),r=I(()=>{if(p.value)return i.responsive==="self"?a.value:e.value}),g=Y(()=>{var _;return(_=Number(O(i.cols.toString(),r.value)))!==null&&_!==void 0?_:ye}),v=Y(()=>O(i.xGap.toString(),r.value)),x=Y(()=>O(i.yGap.toString(),r.value)),C=_=>{a.value=_.contentRect.width},R=_=>{Ze(C,_)},k=b(!1),N=I(()=>{if(i.responsive==="self")return R}),u=b(!1),t=b();return ne(()=>{const{value:_}=t;_&&_.hasAttribute(te)&&(_.removeAttribute(te),u.value=!0)}),ze(he,{layoutShiftDisabledRef:oe(i,"layoutShiftDisabled"),isSsrRef:u,itemStyleRef:oe(i,"itemStyle"),xGapRef:v,overflowRef:k}),{isSsr:!Ae,contentEl:t,mergedClsPrefix:o,style:I(()=>i.layoutShiftDisabled?{width:"100%",display:"grid",gridTemplateColumns:`repeat(${i.cols}, minmax(0, 1fr))`,columnGap:F(i.xGap),rowGap:F(i.yGap)}:{width:"100%",display:"grid",gridTemplateColumns:`repeat(${g.value}, minmax(0, 1fr))`,columnGap:F(v.value),rowGap:F(x.value)}),isResponsive:p,responsiveQuery:r,responsiveCols:g,handleResize:N,overflow:k}},render(){if(this.layoutShiftDisabled)return w("div",ae({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style},this.$attrs),this.$slots);const i=()=>{var o,d,l,a,e,p,r;this.overflow=!1;const g=Je(Le(this)),v=[],{collapsed:x,collapsedRows:C,responsiveCols:R,responsiveQuery:k}=this;g.forEach(m=>{var G,z,B,H,j;if(((G=m==null?void 0:m.type)===null||G===void 0?void 0:G.__GRID_ITEM__)!==!0)return;if(ot(m)){const S=le(m);S.props?S.props.privateShow=!1:S.props={privateShow:!1},v.push({child:S,rawChildSpan:0});return}m.dirs=((z=m.dirs)===null||z===void 0?void 0:z.filter(({dir:S})=>S!==ce))||null,((B=m.dirs)===null||B===void 0?void 0:B.length)===0&&(m.dirs=null);const A=le(m),D=Number((j=O((H=A.props)===null||H===void 0?void 0:H.span,k))!==null&&j!==void 0?j:ue);D!==0&&v.push({child:A,rawChildSpan:D})});let N=0;const u=(o=v[v.length-1])===null||o===void 0?void 0:o.child;if(u!=null&&u.props){const m=(d=u.props)===null||d===void 0?void 0:d.suffix;m!==void 0&&m!==!1&&(N=Number((a=O((l=u.props)===null||l===void 0?void 0:l.span,k))!==null&&a!==void 0?a:ue),u.props.privateSpan=N,u.props.privateColStart=R+1-N,u.props.privateShow=(e=u.props.privateShow)!==null&&e!==void 0?e:!0)}let t=0,_=!1;for(const{child:m,rawChildSpan:G}of v){if(_&&(this.overflow=!0),!_){const z=Number((r=O((p=m.props)===null||p===void 0?void 0:p.offset,k))!==null&&r!==void 0?r:0),B=Math.min(G+z,R);if(m.props?(m.props.privateSpan=B,m.props.privateOffset=z):m.props={privateSpan:B,privateOffset:z},x){const H=t%R;B+H>R&&(t+=R-H),B+t+N>C*R?_=!0:t+=B}}_&&(m.props?m.props.privateShow!==!0&&(m.props.privateShow=!1):m.props={privateShow:!1})}return w("div",ae({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style,[te]:this.isSsr||void 0},this.$attrs),v.map(({child:m})=>m))};return this.isResponsive&&this.responsive==="self"?w(Xe,{onResize:this.handleResize},{default:i}):i()}}),_t=L([J("page-header-header",`
 margin-bottom: 20px;
 `),J("page-header",`
 display: flex;
 align-items: center;
 justify-content: space-between;
 line-height: 1.5;
 font-size: var(--n-font-size);
 `,[U("main",`
 display: flex;
 flex-wrap: nowrap;
 align-items: center;
 `),U("back",`
 display: flex;
 margin-right: 16px;
 font-size: var(--n-back-size);
 cursor: pointer;
 color: var(--n-back-color);
 transition: color .3s var(--n-bezier);
 `,[L("&:hover","color: var(--n-back-color-hover);"),L("&:active","color: var(--n-back-color-pressed);")]),U("avatar",`
 display: flex;
 margin-right: 12px
 `),U("title",`
 margin-right: 16px;
 transition: color .3s var(--n-bezier);
 font-size: var(--n-title-font-size);
 font-weight: var(--n-title-font-weight);
 color: var(--n-title-text-color);
 `),U("subtitle",`
 font-size: 14px;
 transition: color .3s var(--n-bezier);
 color: var(--n-subtitle-text-color);
 `)]),J("page-header-content",`
 font-size: var(--n-font-size);
 `,[L("&:not(:first-child)","margin-top: 20px;")]),J("page-header-footer",`
 font-size: var(--n-font-size);
 `,[L("&:not(:first-child)","margin-top: 20px;")])]),ht=Object.assign(Object.assign({},ve.props),{title:String,subtitle:String,extra:String,onBack:Function}),gt=Z({name:"PageHeader",props:ht,slots:Object,setup(i){const{mergedClsPrefixRef:o,mergedRtlRef:d,inlineThemeDisabled:l}=pe(i),a=ve("PageHeader","-page-header",_t,ut,i,o),e=De("PageHeader",d,o),p=I(()=>{const{self:{titleTextColor:g,subtitleTextColor:v,backColor:x,fontSize:C,titleFontSize:R,backSize:k,titleFontWeight:N,backColorHover:u,backColorPressed:t},common:{cubicBezierEaseInOut:_}}=a.value;return{"--n-title-text-color":g,"--n-title-font-size":R,"--n-title-font-weight":N,"--n-font-size":C,"--n-back-size":k,"--n-subtitle-text-color":v,"--n-back-color":x,"--n-back-color-hover":u,"--n-back-color-pressed":t,"--n-bezier":_}}),r=l?Pe("page-header",void 0,p,i):void 0;return{rtlEnabled:e,mergedClsPrefix:o,cssVars:l?void 0:p,themeClass:r==null?void 0:r.themeClass,onRender:r==null?void 0:r.onRender}},render(){var i;const{onBack:o,title:d,subtitle:l,extra:a,mergedClsPrefix:e,cssVars:p,$slots:r}=this;(i=this.onRender)===null||i===void 0||i.call(this);const{title:g,subtitle:v,extra:x,default:C,header:R,avatar:k,footer:N,back:u}=r,t=o,_=d||g,m=l||v,G=a||x;return w("div",{style:p,class:[`${e}-page-header-wrapper`,this.themeClass,this.rtlEnabled&&`${e}-page-header-wrapper--rtl`]},R?w("div",{class:`${e}-page-header-header`,key:"breadcrumb"},R()):null,(t||k||_||m||G)&&w("div",{class:`${e}-page-header`,key:"header"},w("div",{class:`${e}-page-header__main`,key:"back"},t?w("div",{class:`${e}-page-header__back`,onClick:o},u?u():w(Be,{clsPrefix:e},{default:()=>w(lt,null)})):null,k?w("div",{class:`${e}-page-header__avatar`},k()):null,_?w("div",{class:`${e}-page-header__title`,key:"title"},d||g()):null,m?w("div",{class:`${e}-page-header__subtitle`,key:"subtitle"},l||v()):null),G?w("div",{class:`${e}-page-header__extra`},a||x()):null),C?w("div",{class:`${e}-page-header-content`,key:"content"},C()):null,N?w("div",{class:`${e}-page-header-footer`,key:"footer"},N()):null)}}),yt={class:"ghn-shipping-form"},bt={class:"space-y-4"},xt={class:"space-y-2"},wt={class:"space-y-2"},St={class:"space-y-2"},Ct={class:"mb-2"},kt={class:"shipping-fee p-3 bg-gray-100 dark:bg-gray-800 rounded"},$t={class:"flex justify-between items-center"},Rt={class:"font-medium"},Nt={key:0,class:"flex justify-between items-center mt-1"},Et={class:"font-medium"},Gt={key:1,class:"flex justify-between items-center mt-1"},zt={class:"font-medium"},Bt={class:"flex justify-between items-center mt-1"},Dt={class:"font-medium"},Pt={key:0,class:"text-red-500 text-sm mt-2"},It={class:"flex justify-end"},Ht={__name:"GHNForm",props:{invoiceId:{type:String,required:!0},invoiceItems:{type:Array,default:()=>[]}},emits:["created","error"],setup(i,{emit:o}){const d=i,l=o,a=fe(),e=b({invoice:d.invoiceId,recipient_name:"",recipient_phone:"",province_id:null,district_id:null,ward_code:"",recipient_address:"",weight:500,length:10,width:10,height:10,service_id:53320,payment_method:"prepaid",is_cod:!1,cod_amount:0}),p=b([]),r=b([]),g=b([]),v=b(0),x=b(""),C=b(0),R=I(()=>v.value+(e.value.is_cod?C.value:0)),k=b(!1),N=b(!1),u=b(!1),t=b(""),_=b(!1),m=/^0\d{9}$/,G=I(()=>e.value.recipient_name&&m.test(e.value.recipient_phone)&&e.value.province_id&&e.value.district_id&&e.value.ward_code&&e.value.recipient_address&&v.value>0),z=f=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(f);ne(async()=>{try{const f=await a.get("/api/shipping/provinces");f.status&&f.data&&(p.value=f.data.map(y=>({label:y.ProvinceName,value:y.ProvinceID})));const s=await a.get(`/api/invoice/${d.invoiceId}`);s.status&&s.data&&(C.value=s.data.grand_total||0)}catch(f){console.error("Lỗi khi lấy danh sách tỉnh/thành phố:",f),S("Không thể lấy danh sách tỉnh/thành phố")}});const B=async f=>{if(r.value=[],g.value=[],e.value.district_id=null,e.value.ward_code="",f)try{const s=await a.get(`/api/shipping/districts?province_id=${f}`);s.status&&s.data&&(r.value=s.data.map(y=>({label:y.DistrictName,value:y.DistrictID})))}catch(s){console.error("Lỗi khi lấy danh sách quận/huyện:",s),S("Không thể lấy danh sách quận/huyện")}},H=async f=>{if(g.value=[],e.value.ward_code="",f)try{const s=await a.get(`/api/shipping/wards?district_id=${f}`);s.status&&s.data&&(g.value=s.data.map(y=>({label:y.WardName,value:y.WardCode})))}catch(s){console.error("Lỗi khi lấy danh sách phường/xã:",s),S("Không thể lấy danh sách phường/xã")}},j=f=>{e.value.is_cod=f==="cod",e.value.cod_amount=f==="cod"?C.value:0},A=async()=>{if(e.value.ward_code&&e.value.district_id){k.value=!0,u.value=!1,t.value="",e.value.district_id>=1442&&e.value.district_id<=1480?(x.value="Trong ngày (3-5 tiếng)",v.value=20500):(x.value="1-3 ngày",v.value=3e4);try{const s={service_id:e.value.service_id,district_id:e.value.district_id,ward_code:e.value.ward_code,weight:e.value.weight,length:e.value.length,width:e.value.width,height:e.value.height},y=await a.post("/api/shipping/calculate-fee",s);y.status&&y.data&&y.data.total?(v.value=y.data.total,y.data.expected_delivery_time&&(x.value=y.data.expected_delivery_time),console.log("Expected delivery time:",y.data.expected_delivery_time),console.log("Raw leadtime:",y.data.raw_leadtime)):y.status===!1&&(y.data&&y.data.expected_delivery_time&&(x.value=y.data.expected_delivery_time),console.log("Using default shipping fee:",v.value),console.warn("Lỗi khi tính phí vận chuyển từ GHN, sử dụng phí mặc định:",y.message))}catch(s){console.error("Lỗi khi tính phí vận chuyển:",s),console.warn("Sử dụng phí vận chuyển mặc định:",v.value)}finally{k.value=!1}}else v.value=0,x.value=""},D=async()=>{if(!G.value){m.test(e.value.recipient_phone)||S("Phone number must be 10 digits and start with 0");return}N.value=!0,u.value=!1;try{const f={...e.value};f.payment_method==="cod"&&(f.cod_amount=C.value);const s=await a.post("/api/shipping",f);if(s.status)l("created",s.data);else throw new Error(s.message||"Error creating shipping order")}catch(f){console.error("Error creating shipping order:",f),S("Cannot create shipping order: "+(f.message||"")),l("error",f)}finally{N.value=!1}},S=f=>{u.value=!0,t.value=f},K=async()=>{_.value=!0,u.value=!1;try{const f=await a.get("/api/shipping/test-connection");if(f.status)Q("GHN connection successful");else throw new Error(f.message||"Error checking GHN connection")}catch(f){console.error("Error checking GHN connection:",f),S("Cannot check GHN connection")}finally{_.value=!1}},Q=f=>{console.log(f)};return(f,s)=>{const y=je,T=Ve,X=Oe,be=Fe,se=qe,xe=We,we=Ue,ie=me,Se=Qe,Ce=_e;return P(),M("div",yt,[c(Ce,{title:"Giao hàng qua GHN",size:"small"},{default:h(()=>[n("div",bt,[n("div",xt,[s[9]||(s[9]=n("h3",{class:"font-medium"},"Thông tin người nhận",-1)),c(T,{label:"Họ và tên"},{default:h(()=>[c(y,{value:e.value.recipient_name,"onUpdate:value":s[0]||(s[0]=E=>e.value.recipient_name=E),placeholder:"Nhập họ tên người nhận"},null,8,["value"])]),_:1}),c(T,{label:"Số điện thoại"},{default:h(()=>[c(y,{value:e.value.recipient_phone,"onUpdate:value":s[1]||(s[1]=E=>e.value.recipient_phone=E),placeholder:"Nhập số điện thoại"},null,8,["value"])]),_:1})]),n("div",wt,[s[10]||(s[10]=n("h3",{class:"font-medium"},"Địa chỉ giao hàng",-1)),c(T,{label:"Tỉnh/Thành phố"},{default:h(()=>[c(X,{value:e.value.province_id,"onUpdate:value":[s[2]||(s[2]=E=>e.value.province_id=E),B],options:p.value,placeholder:"Chọn tỉnh/thành phố"},null,8,["value","options"])]),_:1}),c(T,{label:"Quận/Huyện"},{default:h(()=>[c(X,{value:e.value.district_id,"onUpdate:value":[s[3]||(s[3]=E=>e.value.district_id=E),H],options:r.value,placeholder:"Chọn quận/huyện",disabled:!e.value.province_id},null,8,["value","options","disabled"])]),_:1}),c(T,{label:"Phường/Xã"},{default:h(()=>[c(X,{value:e.value.ward_code,"onUpdate:value":[s[4]||(s[4]=E=>e.value.ward_code=E),A],options:g.value,placeholder:"Chọn phường/xã",disabled:!e.value.district_id},null,8,["value","options","disabled"])]),_:1}),c(T,{label:"Address Details"},{default:h(()=>[c(y,{value:e.value.recipient_address,"onUpdate:value":s[5]||(s[5]=E=>e.value.recipient_address=E),placeholder:"House number, street name..."},null,8,["value"])]),_:1})]),n("div",St,[s[18]||(s[18]=n("h3",{class:"font-medium"},"Product Information",-1)),c(T,{label:"Weight (grams)"},{default:h(()=>[c(be,{value:e.value.weight,"onUpdate:value":[s[6]||(s[6]=E=>e.value.weight=E),A],min:100},null,8,["value"])]),_:1}),c(T,{label:"Shipping Service"},{default:h(()=>[c(X,{value:e.value.service_id,"onUpdate:value":[s[7]||(s[7]=E=>e.value.service_id=E),A],options:[{label:"GHN Express",value:53320},{label:"GHN Fast",value:53321}],placeholder:"Select shipping service"},null,8,["value"])]),_:1}),c(T,{label:"Payment Method"},{default:h(()=>[c(we,{value:e.value.payment_method,"onUpdate:value":[s[8]||(s[8]=E=>e.value.payment_method=E),j]},{default:h(()=>[c(xe,null,{default:h(()=>[c(se,{value:"prepaid"},{default:h(()=>s[11]||(s[11]=[V("Prepaid (Only shipping fee)")])),_:1,__:[11]}),c(se,{value:"cod"},{default:h(()=>s[12]||(s[12]=[V("COD (Cash on Delivery)")])),_:1,__:[12]})]),_:1})]),_:1},8,["value"])]),_:1}),n("div",Ct,[c(ie,{size:"small",onClick:K,loading:_.value},{default:h(()=>s[13]||(s[13]=[V(" Test GHN Connection ")])),_:1,__:[13]},8,["loading"])]),n("div",kt,[n("div",$t,[s[14]||(s[14]=n("span",null,"Shipping Fee:",-1)),n("span",Rt,$(k.value?"Calculating...":v.value?z(v.value):"Not determined"),1)]),e.value.payment_method==="cod"?(P(),M("div",Nt,[s[15]||(s[15]=n("span",null,"Product Amount:",-1)),n("span",Et,$(z(C.value)),1)])):W("",!0),e.value.payment_method==="cod"?(P(),M("div",Gt,[s[16]||(s[16]=n("span",null,"Total COD Amount:",-1)),n("span",zt,$(z(R.value)),1)])):W("",!0),n("div",Bt,[s[17]||(s[17]=n("span",null,"Expected Delivery Time:",-1)),n("span",Dt,$(k.value?"Calculating...":x.value||"Not determined"),1)])]),u.value?(P(),M("div",Pt,$(t.value),1)):W("",!0)]),c(Se),n("div",It,[c(ie,{type:"primary",loading:N.value,disabled:!G.value||N.value,onClick:D},{default:h(()=>s[19]||(s[19]=[V(" Create Shipping Order ")])),_:1,__:[19]},8,["loading","disabled"])])])]),_:1})])}}},Tt=Ie(Ht,[["__scopeId","data-v-481be3fb"]]),Mt={class:"flex justify-center items-center h-32"},At={class:"text-red-500"},Vt={class:"grid grid-cols-2 gap-4"},jt={class:"font-medium"},Ot={class:"font-medium"},Ft={class:"font-medium"},Lt={class:"font-medium"},Ut={class:"font-medium capitalize"},qt={class:"font-medium capitalize"},Wt={class:"mt-4"},Qt={class:"border rounded overflow-hidden"},Xt={class:"min-w-full divide-y divide-gray-200"},Yt={class:"bg-white divide-y divide-gray-200"},Jt={class:"px-3 py-2 whitespace-nowrap"},Zt={class:"text-sm"},Kt={key:0,class:"text-xs text-gray-500"},en={class:"px-3 py-2 whitespace-nowrap text-sm"},tn={class:"px-3 py-2 whitespace-nowrap text-sm"},nn={class:"px-3 py-2 whitespace-nowrap text-sm"},sn={class:"space-y-4"},an={class:"text-center"},on={class:"mt-1 text-sm text-gray-500"},ln={class:"font-bold"},rn={class:"text-center space-y-2"},dn={class:"flex gap-2 justify-center mt-4"},Tn={__name:"[id]",setup(i){const o=He(),d=Te(),l=fe(),a=I(()=>o.params.id),e=b(null),p=b(!0),r=b(""),g=b(!1),v=b(""),x=u=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(u),C=u=>{if(!u)return"N/A";const t=new Date(u);return isNaN(t.getTime())?"Invalid date":t.toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},R=async()=>{p.value=!0,r.value="";try{const u=await l.get(`/api/invoice/${a.value}`);if(u.status){if(e.value=u.data,e.value.items)for(const t of e.value.items)if(t.medicine&&typeof t.medicine=="string")try{const _=await l.get(`/api/medicine/${t.medicine}`);_.status&&(t.medicine=_.data)}catch(_){console.error(`Error fetching medicine details for ${t.medicine}:`,_),t.medicine={name:"Unknown Medicine"}}else(!t.medicine||!t.medicine.name)&&(t.medicine={name:t.medicine_name||"Unknown Medicine"});console.log("Loaded invoice with items:",JSON.stringify(e.value.items))}else r.value=u.message||"Failed to load invoice data"}catch(u){console.error("Error loading invoice:",u),r.value=u.message||"An error occurred while loading invoice data"}finally{p.value=!1}},k=u=>{v.value=u.shipping_code,g.value=!0},N=u=>{r.value=u.message||"An error occurred while creating shipping order"};return ne(()=>{R()}),(u,t)=>{const _=gt,m=et,G=_e,z=pt,B=me,H=mt,j=tt,A=Ke;return P(),M("div",null,[c(_,{title:"Create Shipping Order",onBack:t[0]||(t[0]=D=>ee(d).back())},{subtitle:h(()=>[n("span",null,"Invoice: "+$(a.value),1)]),_:1}),c(H,{cols:1,"x-gap":12,"y-gap":12,class:"p-4"},{default:h(()=>[p.value?(P(),re(z,{key:0},{default:h(()=>[c(G,null,{default:h(()=>[n("div",Mt,[c(m,{size:"large"})])]),_:1})]),_:1})):r.value?(P(),re(z,{key:1},{default:h(()=>[c(G,{title:"Error"},{default:h(()=>[n("div",At,$(r.value),1),c(B,{class:"mt-4",onClick:R},{default:h(()=>t[4]||(t[4]=[V("Retry")])),_:1,__:[4]})]),_:1})]),_:1})):e.value?(P(),M(de,{key:2},[c(z,null,{default:h(()=>[c(G,{title:"Invoice Summary",size:"small"},{default:h(()=>{var D;return[n("div",Vt,[n("div",null,[t[5]||(t[5]=n("div",{class:"text-sm text-gray-500"},"Invoice No",-1)),n("div",jt,$(e.value.invoice_no||a.value),1)]),n("div",null,[t[6]||(t[6]=n("div",{class:"text-sm text-gray-500"},"Date",-1)),n("div",Ot,$(C(e.value.date)),1)]),n("div",null,[t[7]||(t[7]=n("div",{class:"text-sm text-gray-500"},"Customer",-1)),n("div",Ft,$(((D=e.value.customer)==null?void 0:D.full_name)||"Walk-in Customer"),1)]),n("div",null,[t[8]||(t[8]=n("div",{class:"text-sm text-gray-500"},"Total Amount",-1)),n("div",Lt,$(x(e.value.grand_total)),1)]),n("div",null,[t[9]||(t[9]=n("div",{class:"text-sm text-gray-500"},"Payment Method",-1)),n("div",Ut,$(e.value.payment_method),1)]),n("div",null,[t[10]||(t[10]=n("div",{class:"text-sm text-gray-500"},"Payment Status",-1)),n("div",qt,$(e.value.payment_status||"Unknown"),1)])]),n("div",Wt,[t[12]||(t[12]=n("h3",{class:"font-medium mb-2"},"Products",-1)),n("div",Qt,[n("table",Xt,[t[11]||(t[11]=n("thead",{class:"bg-gray-50"},[n("tr",null,[n("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Item"),n("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Quantity"),n("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Price"),n("th",{class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Subtotal")])],-1)),n("tbody",Yt,[(P(!0),M(de,null,Me(e.value.items,(S,K)=>{var Q;return P(),M("tr",{key:K},[n("td",Jt,[n("div",Zt,$(((Q=S.medicine)==null?void 0:Q.name)||"Unknown Medicine"),1),S.batch_id?(P(),M("div",Kt,"Batch: "+$(S.batch_id),1)):W("",!0)]),n("td",en,$(S.quantity),1),n("td",tn,$(x(S.price)),1),n("td",nn,$(x(S.subtotal)),1)])}),128))])])])])]}),_:1})]),_:1}),c(z,null,{default:h(()=>{var D;return[c(Tt,{"invoice-id":a.value,"invoice-items":((D=e.value)==null?void 0:D.items)||[],onCreated:k,onError:N},null,8,["invoice-id","invoice-items"])]}),_:1})],64)):W("",!0)]),_:1}),c(A,{show:g.value,"onUpdate:show":t[3]||(t[3]=D=>g.value=D)},{default:h(()=>[c(G,{title:"Shipping Order Created Successfully",class:"w-full max-w-md",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:h(()=>[n("div",sn,[n("div",an,[c(j,{size:"48",color:"green"},{default:h(()=>t[13]||(t[13]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[n("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2m-2 15l-5-5l1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9Z"})],-1)])),_:1,__:[13]}),t[15]||(t[15]=n("h3",{class:"text-lg font-medium mt-2"},"Shipping order has been created successfully!",-1)),n("p",on,[t[14]||(t[14]=V(" Your tracking code: ")),n("span",ln,$(v.value),1)])]),n("div",rn,[t[18]||(t[18]=n("p",null,"You can track your order using the tracking code above.",-1)),n("div",dn,[c(B,{onClick:t[1]||(t[1]=D=>ee(d).push(`/invoice/view/${a.value}`))},{default:h(()=>t[16]||(t[16]=[V(" Back to Invoice ")])),_:1,__:[16]}),c(B,{type:"primary",onClick:t[2]||(t[2]=D=>ee(d).push("/shipping/track"))},{default:h(()=>t[17]||(t[17]=[V(" Track Order ")])),_:1,__:[17]})])])])]),_:1})]),_:1},8,["show"])])}}};export{Tn as default};
