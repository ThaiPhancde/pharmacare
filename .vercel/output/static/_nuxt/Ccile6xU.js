import{c as D,aI as v,aT as I,a as P,ad as T,h as w,g as u,e as c,w as K,u as a,y as N,o as M,k as $,a0 as i}from"./CKxg9VfS.js";import{_ as L}from"./tYwaLfcc.js";import{u as V}from"./Bpf85daN.js";import{a as z}from"./Bjtksisr.js";import{P as A}from"./CdaYbVMG.js";import{T as B}from"./HXfFxbHn.js";import"./DZHg-zPW.js";import"./CtxRJYhM.js";import"./DZiD_n4a.js";import"./8F3V6at2.js";import"./B1BtpM6Q.js";import"./BPEFIfMV.js";import"./ChOKVcqp.js";import"./CqMkjHLC.js";import"./CHIgUVhi.js";import"./Bk27txv5.js";import"./-VWu3lWq.js";import"./DWe5xPtV.js";import"./DxI7QMRn.js";/**
 * @license lucide-vue-next v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=D("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),E={class:"w-full flex flex-col items-stretch gap-4"},F={class:"flex flex-wrap items-end justify-between gap-2"},ie={__name:"index",setup(H){const{toast:l}=v(),d=I(),{data:h,loading:m,pagination:r,fetchData:p,handlePageChange:g}=V(async({page:e,limit:t})=>{const n=await z.get("/api/invoice",{params:{page:e,limit:t}});return r.total=n.total??0,n.data}),y=P(()=>h.value);T(p);const f=e=>new Date(e).toLocaleDateString(),o=e=>e==null?"-":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),_=e=>{if(!e)return"";let t="";return t+=e.payment_method?e.payment_method.toUpperCase():"",e.payment_method==="cash"&&e.payment_details&&e.payment_details.change>0&&(t+=` (Change: ${o(e.payment_details.change)})`),e.payment_method==="card"&&e.payment_details&&e.payment_details.card_number&&(t+=` (${e.payment_details.card_number})`),t},x=e=>{d.push(`/invoice/${e}`)},b=async e=>{if(confirm("Bạn có chắc chắn muốn xóa hóa đơn này không?"))try{m.value=!0;const n=await(await fetch(`/api/invoice/${e}`,{method:"DELETE"})).json();n.status?(l.success("Xóa hóa đơn thành công"),await p()):l.error(n.message||"Xóa hóa đơn thất bại")}catch(t){l.error("Xóa hóa đơn thất bại"),console.error("Failed to delete invoice:",t)}finally{m.value=!1}},k=[{accessorKey:"_id",header:"Invoice ID",cell:({row:e})=>e.original._id||"N/A"},{accessorKey:"date",header:"Date",cell:({row:e})=>f(e.original.date)},{accessorKey:"updatedAt",header:"Last Updated",cell:({row:e})=>e.original.updatedAt?new Date(e.original.updatedAt).toLocaleString():"-"},{accessorKey:"customer",header:"Customer",cell:({row:e})=>{if(!e.original.customer)return"Walk-in Customer";const t=e.original.customer;return t.full_name||t.customer_id||"-"}},{accessorKey:"payment_method",header:"Payment Method",cell:({row:e})=>_(e.original)},{accessorKey:"items",header:"Items",cell:({row:e})=>{var t;return((t=e.original.items)==null?void 0:t.length)||0}},{accessorKey:"grand_total",header:"Total",cell:({row:e})=>o(e.original.grand_total)},{accessorKey:"paid",header:"Paid",cell:({row:e})=>o(e.original.paid)},{accessorKey:"due",header:"Due",cell:({row:e})=>e.original.payment_method==="cash"&&e.original.payment_details&&e.original.payment_details.change>0?`0 (Change: ${o(e.original.payment_details.change)})`:o(e.original.due)},{id:"actions",header:"Actions",cell:({row:e})=>i("div",{class:"flex items-center space-x-2"},[i("button",{class:"p-2 rounded-full hover:bg-gray-100",onClick:()=>x(e.original._id)},[i(U,{class:"h-4 w-4"})]),i("button",{class:"p-2 rounded-full hover:bg-gray-100",onClick:()=>b(e.original._id)},[i(B,{class:"h-4 w-4 text-red-500"})])])}],C=()=>{d.push("/invoice/pos")};return(e,t)=>{const n=N;return M(),w("div",E,[u("div",F,[t[4]||(t[4]=u("h2",{class:"text-2xl font-bold tracking-tight"},"Invoice List",-1)),c(n,{onClick:C},{default:K(()=>[c(a(A),{class:"mr-2 h-4 w-4"}),t[3]||(t[3]=$(" New POS Invoice "))]),_:1,__:[3]})]),c(L,{data:a(y),columns:k,filterKey:"customer",page:a(r).page,"onUpdate:page":t[0]||(t[0]=s=>a(r).page=s),onChangePage:a(g),size:a(r).limit,"onUpdate:size":t[1]||(t[1]=s=>a(r).limit=s),total:a(r).total,"onUpdate:total":t[2]||(t[2]=s=>a(r).total=s)},null,8,["data","page","onChangePage","size","total"])])}}};export{ie as default};
