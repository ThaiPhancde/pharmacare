import{aI as w,a as x,ad as T,h as C,g as m,e as u,w as P,u as o,y as k,o as K,k as E,aZ as l,a0 as n}from"./CKxg9VfS.js";import{_ as b}from"./tYwaLfcc.js";import{u as $}from"./Bpf85daN.js";import{a as A}from"./Bjtksisr.js";import{E as B}from"./DER0kI1M.js";import{P as D}from"./CZYgztcZ.js";import{T as N}from"./HXfFxbHn.js";import"./DZHg-zPW.js";import"./CtxRJYhM.js";import"./DZiD_n4a.js";import"./8F3V6at2.js";import"./B1BtpM6Q.js";import"./BPEFIfMV.js";import"./ChOKVcqp.js";import"./CqMkjHLC.js";import"./CHIgUVhi.js";import"./Bk27txv5.js";import"./-VWu3lWq.js";import"./DWe5xPtV.js";import"./DxI7QMRn.js";const V={class:"w-full flex flex-col items-stretch gap-4"},U={class:"flex flex-wrap items-end justify-between gap-2"},oe={__name:"index",setup(j){const{toast:i}=w(),{data:d,loading:c,pagination:s,fetchData:p,handlePageChange:g}=$(async({page:t,limit:e})=>{const a=await A.get("/api/purchase",{params:{page:t,limit:e}});return s.total=a.total??0,a.data}),h=x(()=>d.value);T(p);const f=[{accessorKey:"supplier",header:"Supplier",cell:({row:t})=>t.original.supplier.name??"-"},{accessorKey:"invoice_no",header:"Invoice No"},{accessorKey:"payment_type",header:"Payment",cell:({row:t})=>t.original.payment_type.charAt(0).toUpperCase()+t.original.payment_type.slice(1)},{accessorKey:"items",header:"Items",cell:({row:t})=>{const a=(t.original.items??[]).map(_=>_.medicine.name).filter(Boolean).join(", "),r=a.length>50?a.slice(0,50).trim()+"...":a;return n("span",{title:a},r||"-")}},{accessorKey:"vat",header:"VAT (%)",cell:({row:t})=>"10"},{accessorKey:"total_price",header:"Total",cell:({row:t})=>t.original.total.toLocaleString("vi-VN")+"₫"},{accessorKey:"actions",header:"Actions",cell:({row:t})=>{const e=t.original;return n("div",{class:"flex gap-2"},[n(B,{class:"w-4 h-4 text-green-600 cursor-pointer hover:scale-110 transition",onClick:()=>l(`/purchase/${e._id}`)}),n(D,{class:"w-4 h-4 text-blue-600 cursor-pointer hover:scale-110 transition",onClick:()=>l(`/purchase/edit/${e._id}`)}),n(N,{class:"w-4 h-4 text-red-600 cursor-pointer hover:scale-110 transition",onClick:()=>y(e)})])}}],y=t=>{confirm(`Are you sure you want to delete purchase ${t.invoice_no}?`)&&v(t._id)},v=async t=>{try{c.value=!0;const a=await(await fetch(`/api/purchase/${t}`,{method:"DELETE"})).json();a.status?(i.success("Xóa đơn hàng thành công"),await p()):i.error(a.message||"Xóa đơn hàng thất bại")}catch(e){i.error("Xóa đơn hàng thất bại"),console.error("Error deleting purchase:",e)}finally{c.value=!1}};return(t,e)=>{const a=k;return K(),C("div",V,[m("div",U,[e[5]||(e[5]=m("h2",{class:"text-2xl font-bold tracking-tight"},"List Purchase",-1)),u(a,{onClick:e[0]||(e[0]=()=>("navigateTo"in t?t.navigateTo:o(l))("/purchase/add"))},{default:P(()=>e[4]||(e[4]=[E(" Add ")])),_:1,__:[4]})]),u(b,{data:o(h),columns:f,filterKey:"name",page:o(s).page,"onUpdate:page":e[1]||(e[1]=r=>o(s).page=r),onChangePage:o(g),size:o(s).limit,"onUpdate:size":e[2]||(e[2]=r=>o(s).limit=r),total:o(s).total,"onUpdate:total":e[3]||(e[3]=r=>o(s).total=r)},null,8,["data","page","onChangePage","size","total"])])}}};export{oe as default};
